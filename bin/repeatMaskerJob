#!/bin/bash -x
set -beEu -o pipefail

if [ $# != 4 ] ; then
    echo "wrong # args: 2bit chrom outdir" >&2
fi
twoBit="$1"
chrom="$2"
outdir="$3"

mydir=$(dirname $(readlink -e "${BASH_SOURCE[0]}"))

rmdir=$(readlink -e "${mydir}/../../progs/RepeatMasker")

chromOutDir=${outdir}/${chrom}
rm -rf ${chromOutDir}
mkdir -p ${chromOutDir}

tmpfa=${chromOutDir}/${chrom}

twoBitToFa ${twoBit}:${chrom} $tmpfa

${rmdir}/RepeatMasker -pa 8 -species=mammal -e hmmer -dir=${chromOutDir} ${tmpfa}
touch ${chromOutDir}/done
